{% extends "layouts/main.html" %}

{% block pageTitle %}
Dashboard - Design maturity survey
{% endblock %}

{% block content %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-full">
    <span class="govuk-caption-xl">{{ department }}</span>
    <h1 class="govuk-heading-xl">Dashboard</h1>

    <div class="govuk-grid-row">
      <div class="govuk-grid-column-one-third">
        <div class="app-card">
          <h2 class="govuk-heading-m">Completed surveys</h2>
          <p class="govuk-body govuk-!-font-size-48 govuk-!-font-weight-bold govuk-!-margin-bottom-0">{{ totalCompleted
            if totalCompleted else 0 }}</p>
        </div>
      </div>
      <div class="govuk-grid-column-one-third">
        <div class="app-card">
          <h2 class="govuk-heading-m">Average score</h2>
          <p class="govuk-body govuk-!-font-size-48 govuk-!-font-weight-bold govuk-!-margin-bottom-0">
            {{ averageScore | round(1) if averageScore else 'N/A' }}
          </p>
        </div>
      </div>
    </div>

    <h2 class="govuk-heading-l govuk-!-margin-top-6">Latest submissions</h2>

    {% if latestSubmissions and latestSubmissions.length > 0 %}

    <table class="govuk-table">
      <thead class="govuk-table__head">
        <tr class="govuk-table__row">
          <th scope="col" class="govuk-table__header">Date</th>
          <th scope="col" class="govuk-table__header">Overall Score</th>
          <th scope="col" class="govuk-table__header">Actions</th>
        </tr>
      </thead>
      <tbody class="govuk-table__body">
        {% for submission in latestSubmissions %}
        <tr class="govuk-table__row">
          <td class="govuk-table__cell">{{ submission.created_at | date }}</td>
          <td class="govuk-table__cell">{{ submission.overall_score | round(1) if submission.overall_score else 'N/A' }}
          </td>
          <td class="govuk-table__cell">
            <a href="/org/responses/{{ submission.id }}" class="govuk-link">View details</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <p class="govuk-body">No submissions yet.</p>
    {% endif %}

    <div class="govuk-grid-row govuk-!-margin-top-6">
      <div class="govuk-grid-column-two-thirds">
        <h2 class="govuk-heading-l">Send survey</h2>

        <form action="/org/surveys/send" method="post" novalidate>
          {{ govukTextarea({
          name: "emails",
          id: "emails",
          label: {
          text: "Email addresses",
          classes: "govuk-label--m"
          },
          hint: {
          text: "Enter email addresses, one per line"
          },
          errorMessage: errors.emails and {
          text: errors.emails
          }
          }) }}

          {{ govukButton({
          text: "Send survey"
          }) }}
        </form>
      </div>
    </div>
  </div>
</div>

<style>
  .app-card {
    background: #ffffff;
    padding: 20px;
    border: 1px solid #b1b4b6;
  }
</style>
{% endblock %}